ARG user=dev
ARG group=${user}
ARG uid=1001
ARG gid=${uid}
ARG hostname=dev

INCLUDE network.makejail
INCLUDE options.makejail

SYSRC sshd_enable=YES

SERVICE sshd start

CMD hostname ${hostname}

CMD echo "UID $uid GID $gid"

CMD pkg upgrade -y

PKG doas
PKG fish
PKG starship
PKG tmux
PKG helix
PKG git-lite
PKG fzf fd-find
PKG eza
PKG bat
PKG rsync
PKG curl
PKG lazygit
PKG xstow

CMD pkg autoremove -y
CMD pkg clean -y

CMD pw groupadd ${group} -g ${gid}

CMD pw user add -n ${user} -u ${uid} -g ${group} -G wheel -w yes -d /home/${user} -s /usr/local/bin/fish -m -h -

CMD echo "permit nopass :wheel" >> /usr/local/etc/doas.conf

MOUNT /data/code /home/${user}/dev
MOUNT /home/admin/configs /home/${user}/configs nullfs ro

CMD pkg autoremove -y
CMD pkg clean -y
