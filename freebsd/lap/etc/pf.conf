## generated by bastille setup
ext_if="em0"

db_serv = "{ 5432, 6379 }"
# port 111 is only for nfs3, nfs4 use only 2049
tcp_serv = "{ 22, 111, 816, 887, 2049, 876, 662 }"
udp_serv = "{ 111, 816, 887, 2049, 876, 662 }"

dev_ports = "{ 8005 }"

set block-policy return
scrub in on $ext_if all fragment reassemble
set skip on lo

table <jails> persist
nat on $ext_if from <jails> to any -> ($ext_if:0)
rdr-anchor "rdr/*"

block in all
pass out quick keep state
antispoof for $ext_if inet

# open postgresql and redis
# pass in proto tcp from 192.168.1.0/24 to any port $db_serv
pass in proto tcp from any to ($ext_if) port $db_serv
pass in proto tcp from any to ($ext_if) port $tcp_serv
pass in proto udp from any to ($ext_if) port $udp_serv
pass out proto tcp from any to ($ext_if) port {111, 2049}

pass in proto tcp from any to ($ext_if) port $dev_ports
pass out proto tcp from any to ($ext_if) port $dev_ports
